<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - SymptoCare</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the background gradient and font */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%); /* Purple/Violet Gradient */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* Style for the logo text color */
        .sympto-color {
            color: #14b8a6; /* A nice teal color */
        }
    </style>
</head>
<body class="p-4">
    <div id="form-container" class="w-full max-w-md bg-white p-8 md:p-10 rounded-3xl shadow-2xl transition-all duration-300">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold sympto-color mb-1">SymptoCare</h1>
            <p class="text-gray-500 text-sm">Your AI Health Companion</p>
        </header>

        <form id="loginForm" class="space-y-6">
            <!-- Global Message Box (used for success/error alerts) -->
            <div id="messageBox" class="hidden p-3 rounded-lg text-center font-medium" role="alert"></div>

            <!-- Username Field -->
            <div>
                <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                <input type="text" id="username" name="username" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150" required>
            </div>

            <!-- Password Field -->
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                <div class="relative mt-1">
                    <input type="password" id="password" name="password" class="block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 pr-12 transition duration-150" required>
                    <button type="button" onclick="togglePasswordVisibility('password')" class="absolute inset-y-0 right-0 flex items-center px-3 text-sm font-medium text-blue-600 hover:text-blue-800 focus:outline-none">Show</button>
                </div>
            </div>

            <!-- Remember Me / Forgot Password -->
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="remember-me" class="ml-2 block text-sm text-gray-900">
                        Remember Me
                    </label>
                </div>
                <div class="text-sm">
                    <a href="#" class="font-medium text-blue-600 hover:text-blue-800">
                        Forgot Password?
                    </a>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300">
                Sign In
            </button>
        </form>

        <!-- Sign Up Link -->
        <p class="text-center text-sm mt-6 text-gray-600">
            Don't have an account? <a href="index.html" class="text-blue-600 hover:text-blue-800 font-medium">Sign up here</a>
        </p>
    </div>

    <script>
        // Function to toggle password visibility (Show/Hide)
        function togglePasswordVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const button = field.nextElementSibling; // The button is the next sibling

            if (field.type === 'password') {
                field.type = 'text';
                button.textContent = 'Hide';
            } else {
                field.type = 'password';
                button.textContent = 'Show';
            }
        }

        // Function to display messages in the message box
        function displayMessage(message, type = 'error') {
            const msgBox = document.getElementById('messageBox');
            msgBox.textContent = message;
            msgBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');

            if (type === 'success') {
                msgBox.classList.add('bg-green-100', 'text-green-700');
            } else {
                msgBox.classList.add('bg-red-100', 'text-red-700');
            }
        }

        // Main login function
        function handleLogin(event) {
            event.preventDefault(); // Stop default form submission
            document.getElementById('messageBox').classList.add('hidden'); // Clear previous messages

            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const username = usernameInput.value;
            const password = passwordInput.value;
            
            // 1. Retrieve the stored JSON payload from Local Storage
            const storedUserJson = localStorage.getItem('symptoCareUser');

            if (!storedUserJson) {
                displayMessage("No user account found. Please sign up first.", 'error');
                return;
            }

            let storedUserData;
            try {
                storedUserData = JSON.parse(storedUserJson);
            } catch (e) {
                console.error("Error parsing stored user data:", e);
                displayMessage("An error occurred during sign in. Please try again.", 'error');
                return;
            }

            // 2. Validate Credentials against stored data
            if (username === storedUserData.username && password === storedUserData.password) {
                // Success
                displayMessage("Sign in successful! Redirecting to dashboard...", 'success');
                
                // Store logged-in state (optional, but good practice)
                localStorage.setItem('isLoggedIn', 'true');

                // Redirect to the dashboard
                setTimeout(() => {
                    window.location.href = 'dashboard.html'; 
                }, 1500);
            } else {
                // Failure
                displayMessage("Invalid username or password. Please check your details.", 'error');
                // Highlight input fields for clarity
                usernameInput.classList.add('border-red-500');
                passwordInput.classList.add('border-red-500');
            }
        }

        // Attach the login function to the form's submit event
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        
        // Remove error border when user starts typing again
        document.getElementById('username').addEventListener('input', () => {
             document.getElementById('username').classList.remove('border-red-500');
             document.getElementById('password').classList.remove('border-red-500');
        });
        document.getElementById('password').addEventListener('input', () => {
             document.getElementById('username').classList.remove('border-red-500');
             document.getElementById('password').classList.remove('border-red-500');
        });

    </script>
</body>
</html>
